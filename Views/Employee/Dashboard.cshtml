@model IEnumerable<ECP.Core.Model.PredictedEmployee>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_ECP.cshtml";
    ViewData["sidebar"] = "sidebar-collapse";
}


<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Dashboard
        </h1>     
    </section>

    <!-- Main content -->
    <section class="content">
        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div class="col-lg-3 col-xs-6">
                <!-- small box -->
                <div class="small-box bg-aqua">
                    <div class="inner">
                        <h3>@ViewData["ActiveEmployees"]</h3>
                        <p>Active Employees</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-person-add"></i>
                    </div>
                    <a href="@Url.Action("Index", "Employee")" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-xs-6">
                <!-- small box -->
                <div class="small-box bg-green">
                    <div class="inner">
                        <h3>@ViewData["AttritionEmployees"]</h3>

                        <p>Attrition Employees</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-ios-person-outline"></i>
                    </div>
                    <a href="@Url.Action("Index", "Employee")" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-xs-6">
                <!-- small box -->
                <div class="small-box bg-yellow">
                    <div class="inner">
                        <h3>@ViewData["RiskyRate"]<sup style="font-size: 20px">%</sup></h3>

                        <p>Attrition Risk Rate</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="@Url.Action("Index", "Employee")" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-3 col-xs-6">
                <!-- small box -->
                <div class="small-box bg-red">
                    <div class="inner">
                        <h3>@ViewData["MostRiskDepartment"]</h3>

                        <p>Most Risk Department</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-pie-graph"></i>
                    </div>
                    <a href="@Url.Action("Index", "Employee")" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <!-- ./col -->
        </div>
        <!-- /.row -->
        <!-- Main row -->
        <div class="row">
            <!-- Left col -->
            <section class="col-lg-6">
                <div class="row" style="padding-left:15px;">
                    <div class="box box-success">
                        <div class="box-header with-border">
                            <h3 class="box-title">Employee by Department</h3>

                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                    <i class="fa fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body chart-responsive">
                            <div class="chart" id="deparment-count" style="height: 250px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></div>
                        </div>
                        <!-- /.box-footer -->
                        <!-- /.box-body -->
                    </div>
                </div>

                <div class="row" style="padding-left:15px;">
                    <div class="box box-danger">
                        <div class="box-header with-border">
                            <h3 class="box-title">Attrition Rate</h3>

                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                    <i class="fa fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body chart-responsive">
                            <div class="chart" id="attrition-rate" style="height: 250px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"> </div>
                        </div>
                        <!-- /.box-footer -->
                        <!-- /.box-body -->
                    </div>
                </div>

            </section>
            <!-- /.Left col -->
            <!-- right col (We are only adding the ID to make the widgets sortable)-->
            <section class="col-lg-6">
                <!-- Default box -->
                <div class="box box-info">
                    <div class="box-header with-border">
                        <h3 class="box-title">Top 10 Risky Employees</h3>
                        <div class="box-tools pull-right">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                <i class="fa fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="row">
                            <div class="col-md-12">
                                <table id="employee-table" name="employee-table" class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th class="col-md-2">Employee No</th>
                                            <th class="col-md-1">Age</th>
                                            <th class="col-md-3">Department</th>
                                            <th class="col-md-3">Job Role</th>
                                            <th class="col-md-3">Attrition Rate</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer clearfix">
                        <a href="/Employee/Index" class="btn btn-sm btn-default btn-flat pull-right">View All Employees</a>
                    </div>
                    <!-- /.box-footer-->
                </div>
                <!-- /.box -->

            </section>
            <!-- right col -->
        </div>
        <!-- /.row (main row) -->

    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->

@section Scripts  {
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>
    
    $(document).ready(function () {
    
            $('#employee-table').DataTable({
                "ajax": {
                    "url": '/Employee/GetTopEmployees',
                    "type": 'GET',
                    "datatype": 'json'
                },
                "columns": [
                    { "data": "employee.employeeId" },
                    { "data": "employee.age" },
                    { "data": "employee.department" },                   
                    { "data": "employee.jobRole" },
                   {
                        "data": "prediction.probability",
                        "render": function (data) {    
                            let barClass;
                            let dataNum = Number(data) * 100;
                            if (dataNum >= 70) {
                                barClass = 'danger'
                            } else if (dataNum >= 40) {
                                barClass = 'yellow'                           
                            } else {
                                barClass = 'success'
                            }
                            let progressBar = '<div title="' + dataNum.toFixed(2) + '%" class="progress progress-xs"><div class="progress-bar progress-bar-' + barClass + '" style="width: ' + dataNum +'%"></div></div>'
                            return progressBar;
                        }
                    }
                    
                ],
                 "lengthChange": false,
                "info": false,
                "searching": false,
                "dom": 'lrtip',
                "scrollX": false,
                "ordering": false,
                "paging": false,
                "language": {
                    "emptyTable": "No data availble"
                }
            });
    })

            var rateData, countData;
      google.charts.load('current', {
                packages: ['corechart', 'bar']
            });
            google.charts.setOnLoadCallback(LoadData);
            //function LoadData() {
            //    return false;
            //}
            function LoadData() {
                $.ajax({
                    url: '/Employee/PopulationAttritionRate',
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        rateData = data;
                        PopulationAttritionRate(rateData);
                        return false;
                    }
                });


                $.ajax({
                    url: '/Employee/PopulationDepartmentCount',
                    dataType: "json",
                    type: "GET",
                    success: function (data) {
                        countData = data;
                        PopulationDepartmentCount(countData);
                        return false;
                    }
                });
                return false;
            }      

          
           


    function PopulationAttritionRate(data) {
        console.log('chk');
            var dataArray = [
                ['Department', 'Attrition Rate']
            ];
            $.each(data, function (i, item) {
                dataArray.push([item.department, item.attritionRate]);
            });
        var data = google.visualization.arrayToDataTable(dataArray);
            var options = {
                //title: 'Revenue',              
                colors: ['#dd4b39'],

                 vAxis: {
                    title: 'Percent (%)',
                    //maxValue: 100,
                    //minValue: 0,
                    gridlines: {
                        count: 4
                    }
                },
                legend: 'none',
                //pointSize: 6,
                //crosshair: { trigger: 'focus', color: 'rgb(60, 141, 188)', opacity: 0.5 }

            };
            var chart = new google.visualization.ColumnChart(document.getElementById('attrition-rate'));

            chart.draw(data, options);
            return false;
        }


    function PopulationDepartmentCount(data) {
            var dataArray = [
                ['Department', 'Employee Count']
            ];
            $.each(data, function (i, item) {
                dataArray.push([item.department, item.employeeCount]);
            });
            var data = google.visualization.arrayToDataTable(dataArray);
            var options = {              
                colors: ['rgb(0, 166, 90)'],
                //hAxis: {
                //    title: 'Month'
                //    minValue: 0
                //},
                //curveType: 'function',
                vAxis: {
                    title: 'Employee Count',                 
                    gridlines: {
                        count: 4
                    }
                },
                legend: 'none',
            };
        var chart = new google.visualization.ColumnChart(document.getElementById('deparment-count'));

            chart.draw(data, options);
            return false;
        }


    $(document).on('hover', 'td div', function () {
            $(this).tooltip();
        })
    </script>
}